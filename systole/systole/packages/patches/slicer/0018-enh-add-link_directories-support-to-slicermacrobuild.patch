From 0d55e620af7b602a56d9670b90a8389490294101 Mon Sep 17 00:00:00 2001
From: Rafael Palomar <rafael.palomar@ous-research.no>
Date: Fri, 20 Feb 2026 22:08:35 +0100
Subject: [PATCH] ENH: Add LINK_DIRECTORIES support to
 SlicerMacroBuildModuleMRML

In system-install builds the MRML libraries (MRMLCore, MRMLLogic,
MRMLDisplayableManager) are plain library names without embedded
RUNPATH information, so the linker cannot find them unless their
directory is in the search path.  Apply the same LINK_DIRECTORIES
pattern already used in SlicerMacroBuildModuleLogic.
---
 CMake/SlicerMacroBuildModuleMRML.cmake | 14 ++++++++++++++
 1 file changed, 14 insertions(+)

diff --git a/CMake/SlicerMacroBuildModuleMRML.cmake b/CMake/SlicerMacroBuildModuleMRML.cmake
index b48552c950..3377567916 100644
--- a/CMake/SlicerMacroBuildModuleMRML.cmake
+++ b/CMake/SlicerMacroBuildModuleMRML.cmake
@@ -35,6 +35,7 @@ macro(SlicerMacroBuildModuleMRML)
   set(multiValueArgs
     SRCS
     INCLUDE_DIRECTORIES
+    LINK_DIRECTORIES
     TARGET_LIBRARIES
     )
   cmake_parse_arguments(MODULEMRML
@@ -53,6 +54,18 @@ macro(SlicerMacroBuildModuleMRML)
     ${Slicer_ModuleMRML_INCLUDE_DIRS}
     )
 
+  if(NOT Slicer_SUPERBUILD)
+    list(APPEND MODULEMRML_LINK_DIRECTORIES
+      ${Slicer_Libs_LIBRARY_DIRS}
+      ${Slicer_Base_LIBRARY_DIRS}
+      )
+    if(DEFINED Slicer_HOME AND DEFINED Slicer_INSTALL_QTLOADABLEMODULES_LIB_DIR)
+      list(APPEND MODULEMRML_LINK_DIRECTORIES
+        "${Slicer_HOME}/${Slicer_INSTALL_QTLOADABLEMODULES_LIB_DIR}"
+        )
+    endif()
+  endif()
+
   if(NOT DEFINED MODULEMRML_FOLDER AND DEFINED MODULE_NAME)
     set(MODULEMRML_FOLDER "Module-${MODULE_NAME}")
   endif()
@@ -68,6 +81,7 @@ macro(SlicerMacroBuildModuleMRML)
     FOLDER ${MODULEMRML_FOLDER}
     SRCS ${MODULEMRML_SRCS}
     INCLUDE_DIRECTORIES ${MODULEMRML_INCLUDE_DIRECTORIES}
+    LINK_DIRECTORIES ${MODULEMRML_LINK_DIRECTORIES}
     TARGET_LIBRARIES ${MODULEMRML_TARGET_LIBRARIES} ${VTK_LIBRARIES} ${MRML_LIBRARIES}
     ${MODULEMRML_NO_INSTALL_OPTION}
     )
-- 
2.52.0

