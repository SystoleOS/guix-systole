From db3e0a29d72c28a2988d4347612a12ec33dbcad3 Mon Sep 17 00:00:00 2001
From: Rafael Palomar <rafael.palomar@ous-research.no>
Date: Wed, 25 Feb 2026 16:47:14 +0100
Subject: [PATCH] ENH: Add standalone build preamble for
 N4ITKBiasFieldCorrection CLI module

Add cmake_minimum_required, project(), CXX_STANDARD, and VTK-guard
so that N4ITKBiasFieldCorrection/CMakeLists.txt can be configured as a standalone
CMake project without needing the full VTK+Qt5 stack.

The VTK guard (pre-setting ITKVtkGlue_LOADED/ITKVTK_LOADED) prevents
ITKConfig.cmake from invoking find_package(VTK) when itk-slicer was
built with Module_ITKVtkGlue=ON.
---
 .../CLI/N4ITKBiasFieldCorrection/CMakeLists.txt    | 14 ++++++++++++++
 1 file changed, 14 insertions(+)

diff --git a/Modules/CLI/N4ITKBiasFieldCorrection/CMakeLists.txt b/Modules/CLI/N4ITKBiasFieldCorrection/CMakeLists.txt
index e5c0104602..ef28f202ed 100755
--- a/Modules/CLI/N4ITKBiasFieldCorrection/CMakeLists.txt
+++ b/Modules/CLI/N4ITKBiasFieldCorrection/CMakeLists.txt
@@ -1,3 +1,17 @@
+cmake_minimum_required(VERSION 3.16.3...3.19.7 FATAL_ERROR)
+project(N4ITKBiasFieldCorrection)
+set(CMAKE_CXX_STANDARD "17")
+
+# Prevent ITKConfig.cmake from loading VTK-dependent modules (ITKVtkGlue,
+# ITKVTK) when itk-slicer was built with Module_ITKVtkGlue=ON.  Without
+# this guard, find_package(ITK) triggers find_package(VTK) -> Qt5 search.
+# Pre-setting these guards makes itk_module_load / _itk_module_config_recurse
+# skip the VTK-dependent modules without invoking find_package(VTK).
+set(_ITK_ITKVtkGlue_USED 1)
+set(_ITK_ITKVTK_USED 1)
+set(ITKVtkGlue_LOADED TRUE)
+set(ITKVTK_LOADED TRUE)
+
 
 #-----------------------------------------------------------------------------
 set(MODULE_NAME N4ITKBiasFieldCorrection)
-- 
2.52.0

