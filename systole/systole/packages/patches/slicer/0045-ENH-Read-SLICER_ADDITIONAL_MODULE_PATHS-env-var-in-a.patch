From 0763aaf2a077c7c921923b1203610ad320597381 Mon Sep 17 00:00:00 2001
From: Rafael Palomar <rafael.palomar@ous-research.no>
Date: Thu, 26 Feb 2026 15:30:35 +0100
Subject: [PATCH] ENH: Read SLICER_ADDITIONAL_MODULE_PATHS env var in
 additionalModulePaths()

---
 Base/QTCore/qSlicerCoreCommandOptions.cxx | 23 +++++++++++++++++++++++
 1 file changed, 23 insertions(+)

diff --git a/Base/QTCore/qSlicerCoreCommandOptions.cxx b/Base/QTCore/qSlicerCoreCommandOptions.cxx
index 881675a251..d90866da43 100644
--- a/Base/QTCore/qSlicerCoreCommandOptions.cxx
+++ b/Base/QTCore/qSlicerCoreCommandOptions.cxx
@@ -170,6 +170,29 @@ QStringList qSlicerCoreCommandOptions::additionalModulePaths()const
   }
   // handle rest of pathS
   allAdditionalModulePaths.append(d->ParsedArgs.value("additional-module-paths").toStringList());
+
+  // Also honour the SLICER_ADDITIONAL_MODULE_PATHS environment variable
+  // (colon-separated on Unix/macOS, semicolon-separated on Windows).
+  // This allows Guix/Nix profile-based deployments to declare module paths
+  // via native-search-path without requiring a shell wrapper to translate
+  // them into command-line arguments.
+  QByteArray envPaths = qgetenv("SLICER_ADDITIONAL_MODULE_PATHS");
+  if (!envPaths.isEmpty())
+    {
+#ifdef Q_OS_WIN
+    const char sep = ';';
+#else
+    const char sep = ':';
+#endif
+    for (const QByteArray& p : envPaths.split(sep))
+      {
+      if (!p.isEmpty())
+        {
+        allAdditionalModulePaths << QString::fromLocal8Bit(p);
+        }
+      }
+    }
+
   return allAdditionalModulePaths;
 }
 
-- 
2.52.0

