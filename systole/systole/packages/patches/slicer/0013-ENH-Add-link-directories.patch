From e70c3972353e3f560460ed8c605a2dd92276e39c Mon Sep 17 00:00:00 2001
From: Rafael Palomar <rafael.palomar@ous-research.no>
Date: Sun, 25 Jan 2026 17:51:36 +0100
Subject: [PATCH 1/3] ENH: Add link directories

WIP: Add link directories
---
 CMake/SlicerMacroBuildLoadableModule.cmake   | 14 ++++++++++++++
 CMake/SlicerMacroBuildModuleLogic.cmake      |  9 +++++++++
 CMake/SlicerMacroBuildModuleQtLibrary.cmake  |  7 +++++++
 CMake/SlicerMacroBuildModuleVTKLibrary.cmake |  7 +++++++
 CMake/SlicerMacroBuildModuleWidgets.cmake    |  9 +++++++++
 5 files changed, 46 insertions(+)

diff --git a/CMake/SlicerMacroBuildLoadableModule.cmake b/CMake/SlicerMacroBuildLoadableModule.cmake
index 624955260c..c2d5d1b129 100644
--- a/CMake/SlicerMacroBuildLoadableModule.cmake
+++ b/CMake/SlicerMacroBuildLoadableModule.cmake
@@ -34,6 +34,7 @@ macro(slicerMacroBuildLoadableModule)
     MOC_SRCS
     UI_SRCS
     INCLUDE_DIRECTORIES
+    LINK_DIRECTORIES
     TARGET_LIBRARIES
     RESOURCES
     )
@@ -103,6 +104,13 @@ macro(slicerMacroBuildLoadableModule)
     ${LOADABLEMODULE_INCLUDE_DIRECTORIES}
     )
 
+  if(NOT Slicer_SUPERBUILD)
+    list(APPEND LOADABLEMODULE_LINK_DIRECTORIES
+      ${Slicer_Libs_LIBRARY_DIRS}
+      ${Slicer_Base_LIBRARY_DIRS}
+      )
+  endif()
+
   #-----------------------------------------------------------------------------
   # Configure export header
   #-----------------------------------------------------------------------------
@@ -213,6 +221,12 @@ macro(slicerMacroBuildLoadableModule)
       ${Slicer_GUI_LIBRARY}
     )
 
+  if(LOADABLEMODULE_LINK_DIRECTORIES)
+    target_link_directories(${lib_name}
+      PUBLIC ${LOADABLEMODULE_LINK_DIRECTORIES}
+      )
+  endif()
+
   # Apply user-defined properties to the library target.
   if(Slicer_LIBRARY_PROPERTIES)
     set_target_properties(${lib_name} PROPERTIES ${Slicer_LIBRARY_PROPERTIES})
diff --git a/CMake/SlicerMacroBuildModuleLogic.cmake b/CMake/SlicerMacroBuildModuleLogic.cmake
index 899e717e92..8ed3151c52 100644
--- a/CMake/SlicerMacroBuildModuleLogic.cmake
+++ b/CMake/SlicerMacroBuildModuleLogic.cmake
@@ -35,6 +35,7 @@ macro(SlicerMacroBuildModuleLogic)
   set(multiValueArgs
     SRCS
     INCLUDE_DIRECTORIES
+    LINK_DIRECTORIES
     TARGET_LIBRARIES
     )
   cmake_parse_arguments(MODULELOGIC
@@ -55,6 +56,13 @@ macro(SlicerMacroBuildModuleLogic)
     ${Slicer_ModuleMRML_INCLUDE_DIRS}
     )
 
+  if(NOT Slicer_SUPERBUILD)
+    list(APPEND MODULELOGIC_LINK_DIRECTORIES
+      ${Slicer_Libs_LIBRARY_DIRS}
+      ${Slicer_Base_LIBRARY_DIRS}
+      )
+  endif()
+
   if(Slicer_BUILD_CLI_SUPPORT)
     # Third-party library
     find_package(SlicerExecutionModel REQUIRED ModuleDescriptionParser)
@@ -102,6 +110,7 @@ macro(SlicerMacroBuildModuleLogic)
     SRCS ${MODULELOGIC_SRCS}
     INCLUDE_DIRECTORIES ${MODULELOGIC_INCLUDE_DIRECTORIES}
     TARGET_LIBRARIES ${MODULELOGIC_TARGET_LIBRARIES}
+    LINK_DIRECTORIES ${MODULELOGIC_LINK_DIRECTORIES}
     ${MODULELOGIC_NO_INSTALL_OPTION}
     )
 
diff --git a/CMake/SlicerMacroBuildModuleQtLibrary.cmake b/CMake/SlicerMacroBuildModuleQtLibrary.cmake
index d2bb43c10b..8671c1dfcb 100644
--- a/CMake/SlicerMacroBuildModuleQtLibrary.cmake
+++ b/CMake/SlicerMacroBuildModuleQtLibrary.cmake
@@ -37,6 +37,7 @@ macro(SlicerMacroBuildModuleQtLibrary)
     MOC_SRCS
     UI_SRCS
     INCLUDE_DIRECTORIES
+    LINK_DIRECTORIES
     TARGET_LIBRARIES
     RESOURCES
     )
@@ -176,6 +177,12 @@ macro(SlicerMacroBuildModuleQtLibrary)
     ${MODULEQTLIBRARY_TARGET_LIBRARIES}
     )
 
+  if(MODULEQTLIBRARY_LINK_DIRECTORIES)
+    target_link_directories(${lib_name}
+      PUBLIC ${MODULEQTLIBRARY_LINK_DIRECTORIES}
+      )
+  endif()
+
   # Apply user-defined properties to the library target.
   if(Slicer_LIBRARY_PROPERTIES)
     set_target_properties(${lib_name} PROPERTIES ${Slicer_LIBRARY_PROPERTIES})
diff --git a/CMake/SlicerMacroBuildModuleVTKLibrary.cmake b/CMake/SlicerMacroBuildModuleVTKLibrary.cmake
index 9e7246a936..7e150949d4 100644
--- a/CMake/SlicerMacroBuildModuleVTKLibrary.cmake
+++ b/CMake/SlicerMacroBuildModuleVTKLibrary.cmake
@@ -35,6 +35,7 @@ macro(SlicerMacroBuildModuleVTKLibrary)
   set(multiValueArgs
     SRCS
     INCLUDE_DIRECTORIES
+    LINK_DIRECTORIES
     TARGET_LIBRARIES
     )
   cmake_parse_arguments(MODULEVTKLIBRARY
@@ -128,6 +129,12 @@ macro(SlicerMacroBuildModuleVTKLibrary)
     ARCHIVE_OUTPUT_DIRECTORY "${CMAKE_BINARY_DIR}/${Slicer_QTLOADABLEMODULES_LIB_DIR}"
     )
 
+  if(MODULEVTKLIBRARY_LINK_DIRECTORIES)
+    target_link_directories(${lib_name}
+      PUBLIC ${MODULEVTKLIBRARY_LINK_DIRECTORIES}
+      )
+  endif()
+
   target_link_libraries(${lib_name}
     ${MODULEVTKLIBRARY_TARGET_LIBRARIES}
     )
diff --git a/CMake/SlicerMacroBuildModuleWidgets.cmake b/CMake/SlicerMacroBuildModuleWidgets.cmake
index 7a5e7d4eba..e358b38bd0 100644
--- a/CMake/SlicerMacroBuildModuleWidgets.cmake
+++ b/CMake/SlicerMacroBuildModuleWidgets.cmake
@@ -37,6 +37,7 @@ macro(SlicerMacroBuildModuleWidgets)
     MOC_SRCS
     UI_SRCS
     INCLUDE_DIRECTORIES
+    LINK_DIRECTORIES
     TARGET_LIBRARIES
     RESOURCES
     )
@@ -63,6 +64,13 @@ macro(SlicerMacroBuildModuleWidgets)
     ${Slicer_GUI_LIBRARY}
     )
 
+  if(NOT Slicer_SUPERBUILD)
+    list(APPEND MODULEWIDGETS_LINK_DIRECTORIES
+      ${Slicer_Libs_LIBRARY_DIRS}
+      ${Slicer_Base_LIBRARY_DIRS}
+      )
+  endif()
+
   if(NOT DEFINED MODULEWIDGETS_FOLDER AND DEFINED MODULE_NAME)
     set(MODULEWIDGETS_FOLDER "Module-${MODULE_NAME}")
   endif()
@@ -109,6 +117,7 @@ macro(SlicerMacroBuildModuleWidgets)
     EXPORT_DIRECTIVE ${MODULEWIDGETS_EXPORT_DIRECTIVE}
     FOLDER ${MODULEWIDGETS_FOLDER}
     INCLUDE_DIRECTORIES ${MODULEWIDGETS_INCLUDE_DIRECTORIES}
+    LINK_DIRECTORIES ${MODULEWIDGETS_LINK_DIRECTORIES}
     SRCS ${MODULEWIDGETS_SRCS} ${QM_OUTPUT_FILES}
     MOC_SRCS ${MODULEWIDGETS_MOC_SRCS}
     UI_SRCS ${MODULEWIDGETS_UI_SRCS}
-- 
2.52.0

