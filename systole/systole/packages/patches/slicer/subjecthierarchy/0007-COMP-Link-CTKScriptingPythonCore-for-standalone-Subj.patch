From 04e33522237ac6452bf025c94c24eceaee502ac8 Mon Sep 17 00:00:00 2001
From: Rafael Palomar <rafael.palomar@ous-research.no>
Date: Tue, 24 Feb 2026 12:33:54 +0100
Subject: [PATCH] COMP: Link CTKScriptingPythonCore for standalone
 SubjectHierarchy builds

qSlicerSubjectHierarchyModule.cxx calls
ctkAbstractPythonManager::executeString() in its setup() function when
Slicer_USE_PYTHONQT is ON.  The symbol lives in libCTKScriptingPythonCore.so.
In the full Slicer superbuild this is satisfied transitively through
qSlicerBaseQTCore.  In a standalone (install-tree) build the transitive
dependency is not propagated, so the linker fails with an undefined
reference.

Add CTKScriptingPythonCore to MODULE_TARGET_LIBRARIES explicitly when
Slicer_USE_PYTHONQT is ON so the symbol is available in all build contexts.
---
 Modules/Loadable/SubjectHierarchy/CMakeLists.txt | 6 ++++++
 1 file changed, 6 insertions(+)

diff --git a/Modules/Loadable/SubjectHierarchy/CMakeLists.txt b/Modules/Loadable/SubjectHierarchy/CMakeLists.txt
index 39c94048ce..abb3d4bc8d 100644
--- a/Modules/Loadable/SubjectHierarchy/CMakeLists.txt
+++ b/Modules/Loadable/SubjectHierarchy/CMakeLists.txt
@@ -57,6 +57,12 @@ set(MODULE_TARGET_LIBRARIES
   vtkSlicer${MODULE_NAME}ModuleLogic
   qSlicer${MODULE_NAME}ModuleWidgets
   )
+if(Slicer_USE_PYTHONQT)
+  # qSlicerSubjectHierarchyModule calls ctkAbstractPythonManager::executeString()
+  # directly; link CTKScriptingPythonCore so the symbol is available in standalone
+  # (install-tree) builds where transitive deps from Slicer core are not propagated.
+  list(APPEND MODULE_TARGET_LIBRARIES CTKScriptingPythonCore)
+endif()
 
 set(MODULE_RESOURCES
   Resources/qSlicer${MODULE_NAME}Module.qrc
-- 
2.52.0

