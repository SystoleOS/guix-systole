From b06dd255a1e7fb49d28d1cf073b052fd358fac91 Mon Sep 17 00:00:00 2001
From: Rafael Palomar <rafael.palomar@ous-research.no>
Date: Tue, 24 Feb 2026 12:25:12 +0100
Subject: [PATCH] COMP: Add PythonQt include dir for standalone
 SubjectHierarchy builds

UseSlicer.cmake calls find_package(PythonQt) when Slicer_USE_PYTHONQT
is ON, which sets PYTHONQT_INCLUDE_DIR, but never adds it to the
compiler include path.  In a standalone (install-tree) build the Slicer
core's global include_directories() calls are absent, so CTK headers
that include PythonQtPythonInclude.h directly (e.g.
ctkAbstractPythonManager.h) fail to compile.

Add include_directories(${PYTHONQT_INCLUDE_DIR}) after
include(${Slicer_USE_FILE}) so that all targets in this CMake project
have access to the PythonQt headers when Slicer_USE_PYTHONQT is ON.
---
 Modules/Loadable/SubjectHierarchy/CMakeLists.txt | 8 ++++++++
 1 file changed, 8 insertions(+)

diff --git a/Modules/Loadable/SubjectHierarchy/CMakeLists.txt b/Modules/Loadable/SubjectHierarchy/CMakeLists.txt
index 39c94048ce..515da8e3b8 100644
--- a/Modules/Loadable/SubjectHierarchy/CMakeLists.txt
+++ b/Modules/Loadable/SubjectHierarchy/CMakeLists.txt
@@ -9,6 +9,14 @@ string(TOUPPER ${MODULE_NAME} MODULE_NAME_UPPER)
 set(CMAKE_CXX_STANDARD "17")
 find_package(Slicer REQUIRED)
 include(${Slicer_USE_FILE})
+# UseSlicer.cmake calls find_package(PythonQt) when Slicer_USE_PYTHONQT is ON,
+# which sets PYTHONQT_INCLUDE_DIR, but does not add it to the compiler include
+# path.  CTK headers like ctkAbstractPythonManager.h include
+# PythonQtPythonInclude.h directly; expose the PythonQt include directory here
+# so all compilation units in this project can find that header.
+if(Slicer_USE_PYTHONQT AND PYTHONQT_INCLUDE_DIR)
+  include_directories(${PYTHONQT_INCLUDE_DIR})
+endif()
 # UseSlicer.cmake resets Slicer_INSTALL_QTLOADABLEMODULES_SHARE_DIR to empty
 # when Slicer_QTLOADABLEMODULES_SHARE_DIR is unset (standalone builds).
 if(NOT Slicer_INSTALL_QTLOADABLEMODULES_SHARE_DIR)
-- 
2.52.0

