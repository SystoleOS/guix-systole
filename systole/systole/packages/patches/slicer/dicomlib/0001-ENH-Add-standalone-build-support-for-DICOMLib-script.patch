From bd5538bfb3a71297cea1679aea9b0f1b40c65360 Mon Sep 17 00:00:00 2001
From: Rafael Palomar <rafael.palomar@ous-research.no>
Date: Sun, 22 Feb 2026 18:40:20 +0100
Subject: [PATCH] ENH: Add standalone build support for DICOMLib scripted
 module

Add the standard standalone build preamble with guards for both
QTLOADABLEMODULES dirs (used by C++ Logic/Widgets/SHPlugin libraries)
and QTSCRIPTEDMODULES dirs (used by slicerMacroBuildScriptedModule for
Python files). Add LINK_DIRECTORIES ${EXTRA_MODULE_LIB_DIRS} to all
four C++ build macro calls.
---
 Modules/Scripted/DICOMLib/CMakeLists.txt      | 27 +++++++++++++++++++
 .../Scripted/DICOMLib/Logic/CMakeLists.txt    |  1 +
 .../SubjectHierarchyPlugins/CMakeLists.txt    |  1 +
 .../Scripted/DICOMLib/Widgets/CMakeLists.txt  |  1 +
 4 files changed, 30 insertions(+)

diff --git a/Modules/Scripted/DICOMLib/CMakeLists.txt b/Modules/Scripted/DICOMLib/CMakeLists.txt
index 549269a952..6b49a968db 100644
--- a/Modules/Scripted/DICOMLib/CMakeLists.txt
+++ b/Modules/Scripted/DICOMLib/CMakeLists.txt
@@ -1,3 +1,30 @@
+cmake_minimum_required(VERSION 3.16.3...3.19.7 FATAL_ERROR)
+project(DICOMLib)
+
+set(CMAKE_CXX_STANDARD "17")
+
+find_package(Slicer REQUIRED)
+include(${Slicer_USE_FILE})
+
+# UseSlicer.cmake resets QTLOADABLEMODULES dirs to empty in standalone builds.
+if(NOT Slicer_INSTALL_QTLOADABLEMODULES_SHARE_DIR)
+  set(Slicer_INSTALL_QTLOADABLEMODULES_SHARE_DIR
+    "./share/Slicer-${Slicer_VERSION}/qt-loadable-modules")
+endif()
+if(NOT Slicer_INSTALL_QTLOADABLEMODULES_LIB_DIR)
+  set(Slicer_INSTALL_QTLOADABLEMODULES_LIB_DIR
+    "./lib/Slicer-${Slicer_VERSION}/qt-loadable-modules")
+endif()
+# QTSCRIPTEDMODULES dirs for the Python files installed by slicerMacroBuildScriptedModule.
+if(NOT Slicer_QTSCRIPTEDMODULES_LIB_DIR)
+  set(Slicer_QTSCRIPTEDMODULES_LIB_DIR
+    "lib/Slicer-${Slicer_VERSION}/qt-scripted-modules")
+endif()
+if(NOT Slicer_INSTALL_QTSCRIPTEDMODULES_LIB_DIR)
+  set(Slicer_INSTALL_QTSCRIPTEDMODULES_LIB_DIR
+    "lib/Slicer-${Slicer_VERSION}/qt-scripted-modules")
+endif()
+
 #-----------------------------------------------------------------------------
 set(MODULE_NAME DICOMLib)
 string(TOUPPER ${MODULE_NAME} MODULE_NAME_UPPER)
diff --git a/Modules/Scripted/DICOMLib/Logic/CMakeLists.txt b/Modules/Scripted/DICOMLib/Logic/CMakeLists.txt
index 38b20ba49d..4c3bd873e4 100644
--- a/Modules/Scripted/DICOMLib/Logic/CMakeLists.txt
+++ b/Modules/Scripted/DICOMLib/Logic/CMakeLists.txt
@@ -25,4 +25,5 @@ SlicerMacroBuildModuleLogic(
   INCLUDE_DIRECTORIES ${${KIT}_INCLUDE_DIRECTORIES}
   SRCS ${${KIT}_SRCS}
   TARGET_LIBRARIES ${${KIT}_TARGET_LIBRARIES}
+  LINK_DIRECTORIES ${EXTRA_MODULE_LIB_DIRS}
   )
diff --git a/Modules/Scripted/DICOMLib/SubjectHierarchyPlugins/CMakeLists.txt b/Modules/Scripted/DICOMLib/SubjectHierarchyPlugins/CMakeLists.txt
index 453f4bce1c..d99138553a 100644
--- a/Modules/Scripted/DICOMLib/SubjectHierarchyPlugins/CMakeLists.txt
+++ b/Modules/Scripted/DICOMLib/SubjectHierarchyPlugins/CMakeLists.txt
@@ -51,4 +51,5 @@ SlicerMacroBuildModuleQtLibrary(
   TARGET_LIBRARIES ${${KIT}_TARGET_LIBRARIES}
   RESOURCES ${${KIT}_RESOURCES}
   WRAP_PYTHONQT
+  LINK_DIRECTORIES ${EXTRA_MODULE_LIB_DIRS}
   )
diff --git a/Modules/Scripted/DICOMLib/Widgets/CMakeLists.txt b/Modules/Scripted/DICOMLib/Widgets/CMakeLists.txt
index bf25739d7f..f7febfd73b 100644
--- a/Modules/Scripted/DICOMLib/Widgets/CMakeLists.txt
+++ b/Modules/Scripted/DICOMLib/Widgets/CMakeLists.txt
@@ -55,6 +55,7 @@ SlicerMacroBuildModuleWidgets(
   TARGET_LIBRARIES ${${KIT}_TARGET_LIBRARIES}
   RESOURCES ${${KIT}_RESOURCES}
   WRAP_PYTHONQT
+  LINK_DIRECTORIES ${EXTRA_MODULE_LIB_DIRS}
   )
 
 #-----------------------------------------------------------------------------
-- 
2.52.0

