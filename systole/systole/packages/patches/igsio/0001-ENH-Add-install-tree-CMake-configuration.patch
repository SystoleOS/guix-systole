From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: Rafael Palomar <rafael.palomar@ous-research.no>
Date: Thu, 27 Feb 2026 12:00:00 +0100
Subject: [PATCH] ENH: Add install-tree CMake configuration to IGSIO

Add install(EXPORT IGSIO ...) and an install-tree IGSIOConfig.cmake so
that downstream packages can use find_package(IGSIO) against the installed
IGSIO store path.  The install-tree config provides compatibility
include-dir variables (VTKIGSIOCOMMON_INCLUDE_DIRS etc.) computed
relative to the config file location and does not call find_package(VTK)
or find_package(vtkAddon) since consumers in the Slicer module build
context have those targets available via find_package(Slicer).
---
 CMakeLists.txt                       | 14 +++++++++++
 CMake/IGSIOInstallConfig.cmake.in    | 36 ++++++++++++++++++++++++++++
 2 files changed, 50 insertions(+)
 create mode 100644 CMake/IGSIOInstallConfig.cmake.in

diff --git a/CMakeLists.txt b/CMakeLists.txt
index 1111111..2222222 100644
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -177,4 +177,18 @@ else()
   list(APPEND IGSIO_INSTALL_CMAKE_FILES} "${CMAKE_CURRENT_BINARY_DIR}/IGSIOConfigVersion.cmake")
   include(${CMAKE_SOURCE_DIR}/CMake/GenerateIGSIOConfig.cmake)

+  #---------------------------------------------------------------------------
+  # Install CMake configuration and exported targets for the install tree.
+  # Downstream packages can then use find_package(IGSIO) against the
+  # installed prefix.
+  set(IGSIO_INSTALL_CMAKE_DIR "lib/cmake/IGSIO")
+  configure_file(${IGSIO_SOURCE_DIR}/CMake/IGSIOInstallConfig.cmake.in
+                 ${IGSIO_BINARY_DIR}/IGSIOInstallConfig.cmake @ONLY)
+  install(FILES ${IGSIO_BINARY_DIR}/IGSIOInstallConfig.cmake
+    DESTINATION ${IGSIO_INSTALL_CMAKE_DIR}
+    RENAME IGSIOConfig.cmake)
+  install(EXPORT IGSIO
+    DESTINATION ${IGSIO_INSTALL_CMAKE_DIR}
+    FILE IGSIOTargets.cmake)
+
 endif()
diff --git a/CMake/IGSIOInstallConfig.cmake.in b/CMake/IGSIOInstallConfig.cmake.in
new file mode 100644
index 0000000..aaaaaaa
--- /dev/null
+++ b/CMake/IGSIOInstallConfig.cmake.in
@@ -0,0 +1,36 @@
+# IGSIOConfig.cmake â€” install-tree version
+#
+# This file is generated by Guix guix-systole to support find_package(IGSIO)
+# against the installed IGSIO store path.  It does NOT call find_package(VTK)
+# or find_package(vtkAddon); consumers must ensure VTK targets are already
+# defined (e.g. via find_package(Slicer) or find_package(VTK)) before
+# including this file.
+
+get_filename_component(_IGSIO_CONFIG_DIR
+  "${CMAKE_CURRENT_LIST_FILE}" PATH)
+
+# Import IGSIO library targets.
+if(EXISTS "${_IGSIO_CONFIG_DIR}/IGSIOTargets.cmake")
+  include("${_IGSIO_CONFIG_DIR}/IGSIOTargets.cmake")
+else()
+  message(FATAL_ERROR "IGSIOTargets.cmake not found in ${_IGSIO_CONFIG_DIR}")
+endif()
+
+# Compute install prefix: <prefix>/lib/cmake/IGSIO  =>  <prefix>
+get_filename_component(_IGSIO_PREFIX
+  "${_IGSIO_CONFIG_DIR}/../../.." ABSOLUTE)
+
+# Include-dir compatibility variables.  All IGSIO headers are installed
+# under a single include directory.
+set(VTKIGSIOCOMMON_INCLUDE_DIRS
+  "${_IGSIO_PREFIX}/@IGSIO_INCLUDE_INSTALL@")
+set(VTKSEQUENCEIO_INCLUDE_DIRS
+  "${_IGSIO_PREFIX}/@IGSIO_INCLUDE_INSTALL@")
+set(VTKVOLUMERECONSTRUCTION_INCLUDE_DIRS
+  "${_IGSIO_PREFIX}/@IGSIO_INCLUDE_INSTALL@")
+set(VTKIGSIOCALIBRATION_INCLUDE_DIRS
+  "${_IGSIO_PREFIX}/@IGSIO_INCLUDE_INSTALL@")
+
+# Build-option flags used by consumers to conditionally compile code.
+set(IGSIO_BUILD_SEQUENCEIO @IGSIO_BUILD_SEQUENCEIO@)
+set(IGSIO_BUILD_VOLUMERECONSTRUCTION @IGSIO_BUILD_VOLUMERECONSTRUCTION@)
+set(IGSIO_USE_VP9 @IGSIO_USE_VP9@)
