From 5e5e5d1d3b5dac55d9986c629588f0967a88b715 Mon Sep 17 00:00:00 2001
From: Rafael Palomar <rafael.palomar@ous-research.no>
Date: Fri, 27 Feb 2026 12:06:48 +0100
Subject: [PATCH] ENH: Add standalone CMake preamble for UltrasoundSnapshots

Add cmake_minimum_required + find_package(Slicer) preamble
so the loadable module can be built standalone against an
installed Slicer.
---
 UltrasoundSnapshots/CMakeLists.txt | 136 ++++++++++++++++-------------
 1 file changed, 77 insertions(+), 59 deletions(-)

diff --git a/UltrasoundSnapshots/CMakeLists.txt b/UltrasoundSnapshots/CMakeLists.txt
index 2ca42d9..9b9fbea 100644
--- a/UltrasoundSnapshots/CMakeLists.txt
+++ b/UltrasoundSnapshots/CMakeLists.txt
@@ -1,59 +1,77 @@
-#-----------------------------------------------------------------------------
-set(MODULE_NAME UltrasoundSnapshots)
-set(MODULE_TITLE ${MODULE_NAME})
-
-string(TOUPPER ${MODULE_NAME} MODULE_NAME_UPPER)
-
-#-----------------------------------------------------------------------------
-add_subdirectory(Logic)
-
-#-----------------------------------------------------------------------------
-set(MODULE_EXPORT_DIRECTIVE "Q_SLICER_QTMODULES_${MODULE_NAME_UPPER}_EXPORT")
-
-# Current_{source,binary} and Slicer_{Libs,Base} already included
-set(MODULE_INCLUDE_DIRECTORIES
-  ${CMAKE_CURRENT_SOURCE_DIR}/Logic
-  ${CMAKE_CURRENT_BINARY_DIR}/Logic
-  )
-
-set(MODULE_SRCS
-  qSlicer${MODULE_NAME}Module.cxx
-  qSlicer${MODULE_NAME}Module.h
-  qSlicer${MODULE_NAME}ModuleWidget.cxx
-  qSlicer${MODULE_NAME}ModuleWidget.h
-  )
-
-set(MODULE_MOC_SRCS
-  qSlicer${MODULE_NAME}Module.h
-  qSlicer${MODULE_NAME}ModuleWidget.h
-  )
-
-set(MODULE_UI_SRCS
-  Resources/UI/qSlicer${MODULE_NAME}Module.ui
-  )
-
-set(MODULE_TARGET_LIBRARIES
-  vtkSlicer${MODULE_NAME}ModuleLogic
-  )
-
-set(MODULE_RESOURCES
-  Resources/qSlicer${MODULE_NAME}Module.qrc
-  )
-
-#-----------------------------------------------------------------------------
-slicerMacroBuildQtModule(
-  NAME ${MODULE_NAME}
-  TITLE ${MODULE_TITLE}
-  EXPORT_DIRECTIVE ${MODULE_EXPORT_DIRECTIVE}
-  INCLUDE_DIRECTORIES ${MODULE_INCLUDE_DIRECTORIES}
-  SRCS ${MODULE_SRCS}
-  MOC_SRCS ${MODULE_MOC_SRCS}
-  UI_SRCS ${MODULE_UI_SRCS}
-  TARGET_LIBRARIES ${MODULE_TARGET_LIBRARIES}
-  RESOURCES ${MODULE_RESOURCES}
-  )
-
-#-----------------------------------------------------------------------------
-if(BUILD_TESTING)
-  add_subdirectory(Testing)
-endif()
+cmake_minimum_required(VERSION 3.16.3...3.19.7 FATAL_ERROR)
+
+project(UltrasoundSnapshots)
+
+set(CMAKE_CXX_STANDARD "17")
+
+find_package(Slicer REQUIRED)
+include(${Slicer_USE_FILE})
+
+if(NOT Slicer_INSTALL_QTLOADABLEMODULES_LIB_DIR)
+  set(Slicer_INSTALL_QTLOADABLEMODULES_LIB_DIR
+    "lib/Slicer-${Slicer_VERSION}/qt-loadable-modules")
+endif()
+if(NOT Slicer_INSTALL_QTLOADABLEMODULES_SHARE_DIR)
+  set(Slicer_INSTALL_QTLOADABLEMODULES_SHARE_DIR
+    "share/Slicer-${Slicer_VERSION}/qt-loadable-modules")
+endif()
+
+#-----------------------------------------------------------------------------
+set(MODULE_NAME UltrasoundSnapshots)
+set(MODULE_TITLE ${MODULE_NAME})
+
+string(TOUPPER ${MODULE_NAME} MODULE_NAME_UPPER)
+
+#-----------------------------------------------------------------------------
+add_subdirectory(Logic)
+
+#-----------------------------------------------------------------------------
+set(MODULE_EXPORT_DIRECTIVE "Q_SLICER_QTMODULES_${MODULE_NAME_UPPER}_EXPORT")
+
+# Current_{source,binary} and Slicer_{Libs,Base} already included
+set(MODULE_INCLUDE_DIRECTORIES
+  ${CMAKE_CURRENT_SOURCE_DIR}/Logic
+  ${CMAKE_CURRENT_BINARY_DIR}/Logic
+  )
+
+set(MODULE_SRCS
+  qSlicer${MODULE_NAME}Module.cxx
+  qSlicer${MODULE_NAME}Module.h
+  qSlicer${MODULE_NAME}ModuleWidget.cxx
+  qSlicer${MODULE_NAME}ModuleWidget.h
+  )
+
+set(MODULE_MOC_SRCS
+  qSlicer${MODULE_NAME}Module.h
+  qSlicer${MODULE_NAME}ModuleWidget.h
+  )
+
+set(MODULE_UI_SRCS
+  Resources/UI/qSlicer${MODULE_NAME}Module.ui
+  )
+
+set(MODULE_TARGET_LIBRARIES
+  vtkSlicer${MODULE_NAME}ModuleLogic
+  )
+
+set(MODULE_RESOURCES
+  Resources/qSlicer${MODULE_NAME}Module.qrc
+  )
+
+#-----------------------------------------------------------------------------
+slicerMacroBuildQtModule(
+  NAME ${MODULE_NAME}
+  TITLE ${MODULE_TITLE}
+  EXPORT_DIRECTIVE ${MODULE_EXPORT_DIRECTIVE}
+  INCLUDE_DIRECTORIES ${MODULE_INCLUDE_DIRECTORIES}
+  SRCS ${MODULE_SRCS}
+  MOC_SRCS ${MODULE_MOC_SRCS}
+  UI_SRCS ${MODULE_UI_SRCS}
+  TARGET_LIBRARIES ${MODULE_TARGET_LIBRARIES}
+  RESOURCES ${MODULE_RESOURCES}
+  )
+
+#-----------------------------------------------------------------------------
+if(BUILD_TESTING)
+  add_subdirectory(Testing)
+endif()
-- 
2.52.0

